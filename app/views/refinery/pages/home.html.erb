<%-# render '/refinery/content_page' %>

<div class="row">
  <div class="col-lg-9 col-md-8 col-sm-12">
    <h3>
      <span class="social-media-icon icon-sm news"></span> <%= link_to "News", refinery.blog_root_path %>
    </h3>

    <div class="row blog-posts-grid">
      <%- Refinery::Blog::Post.order("published_at DESC").limit(10).each do |post| %>
        <div class="col-lg-4 col-md-6 blog-posts-grid-item">

          <article class="blog_post">
            <header>
              <section class='details'>
                <%= post.author.username if post.author.present? %>
                <time datetime="<%=l post.published_at.to_date, :format => :default %>" class='posted_at'>
                  @ <%= l(post.published_at.to_date, :format => :short) %>
                </time>

                <% if (categories = post.categories).any? %>
                  <span class='filled_in'>
                    <% categories.each_with_index do |category, index| %>
                      <%= link_to "##{category.title}", refinery.blog_category_path(category) -%><%= ',' if index < ((categories.length) - 1) %>
                    <% end %>
                  </span>
                <% end %>
              </section>
              <% if post.source_url.present? %>
                <div class='blog_source'>
                  <%= "#{t('source', :scope => 'refinery.blog.posts.show')}: " %>
                  <%= link_to (post.source_url_title.blank? ? post.source_url : post.source_url_title), post.source_url %>
                </div>
              <% end %>
              <h2><%= link_to post.title, refinery.blog_post_path(post) %></h2>
            </header>
            <section class='clearfix'>
              <%= post.custom_teaser.html_safe %>
            </section>
          </article>

        </div>
      <% end %>
    </div>
  </div>
  <div class="col-lg-3 col-md-4 col-sm-12">
    <div>
      <%= render "common/twitch_users_status" %>
    </div>

    <div>
      <%= render "common/latest_youtube_video" %>
    </div>

    <div>
      <%= render "common/facebook_feed" %>
    </div>

    <div>
      <%= render "common/twitter_feed" %>
    </div>
  </div>
</div>

<%- content_for :javascripts do %>
  <script>
    (function() {
      $(document).ready(function() {
        imagesLoaded($('.blog-posts-grid'), function() {
          $('.blog-posts-grid').masonry({
            itemSelector: '.blog-posts-grid-item'
          });
        });
      });
    })();
  </script>
<% end %>
